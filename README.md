# SETUP AND DEVELOPING AN APPLICATION IN HL7-FHIR IN WINDOWS:

This is a guide document on how to start and build an **HL7-FHIR app project** in Visual Studio Code.
This application is developed in **C#**, using external **NuGet** packages to support development.

# The 1st Project

The first project will consist in communicating with the server by getting a list of patients, searching for an specific one and a getting a short and brief description about patient resources.

## Needed Tools

The developent of the app will need certain requirements.

- [**VISUAL STUDIO**](https://visualstudio.microsoft.com/)**/**[**VISUAL STUDIO CODE**](https://visualstudio.microsoft.com/)
- [**Windows Pretty Terminal**](https://www.hanselman.com/blog/how-to-make-a-pretty-prompt-in-windows-terminal-with-powerline-nerd-fonts-cascadia-code-wsl-and-ohmyposh) **(not Mandatory)**
- [**HL7-FHIR V4**](https://www.nuget.org/packages/Hl7.Fhir.R4/)
- [**GIT**](https://git-scm.com/)
- [**.NET**](https://dotnet.microsoft.com/download/dotnet-core) **(Preference Up to date)**
- [**C# XML Documentation Comments**](https://marketplace.visualstudio.com/items?itemName=k--kato.docomment)
- [**Postman**](https://www.postman.com/downloads/)

## Create and Setup the evironment

First, you need to create the folders and access the folder that you chose as your project directory.

## Create And Access the Folder:

````bash
 mkdir FhirApp
 cd FhirApp
````

## Create Project

````bash
 dotnet new console - n <NameOfProject>
 cd <NameOfProject>
````

Another way and easier to create is trought this following command:

```bash
 dotnet new console - n <NameOfProject> -o src
 cd src
```

the src means the source folder that we are at the moment, if you dont put it the programm will assume by default the folder you are already into.

the -n option is short for --name.

It specifies the name of the project that the dotnet new command will create.

# INSTALL THE PACKAGES:

When working with HL7 standard and choosing a version of the protocol, it is possible to run different versions in the same project but it isn't recomended, so choose one wisely and search for wich one will be better for you to chose.
In this Project we will advice using the **version R4** of Fhir.

## SETUP THE NUGETS (CHOOSE A VERSION):

If you want to know more about the versions consult:

https://www.nuget.org/packages/Hl7.Fhir.R4/.

### HL7-FHIR V-STU3:

```bash
- dotnet add package Hl7.Fhir.STU3 
- dotnet add package Hl7.Fhir.Specification.STU3
```

### HL7-FHIR V-R4:

```bash
 dotnet add package Hl7.Fhir.R4
 dotnet add package Hl7.Fhir.Specification.R4
```

### HL7-FHIR V-R4B:

```bash
 dotnet add package Hl7.Fhir.R4B
 dotnet add package Hl7.Fhir.Specification.R4B
```

### HL7-FHIR V-R5:

```bash
 dotnet add package Hl7.Fhir.R5 
 dotnet add package Hl7.Fhir.Specification.R5
```

### RUN THE PROJECT:

To start the project in visual run the following comand:

```bash
dotnet run --project <NameOfProject>
```

# HANDS ON FHIR

After running and settup the application, we will be able to start to put hands on the project.

## Libaries

To know more about how to work with the libaries consult:

https://docs.fire.ly/projects/Firely-NET-SDK/en/latest/start.html

When working with the data model types, to see the specification of each element, so it is important also to consult:

https://hl7.org/fhir/

### Fhir Model

Hl7.Fhir.Model contains model classes that correspond to the FHIR Resources and data types, like Patient and HumanName. The code is generated by the FHIR publication tool, which is used to build a new version of the FHIR website.

```bash
#Adding the libary
using Hl7.Fhir.Model

#Creating patient resource instance
var pat = new Patient();

# Creating a instance of a datatype
var id = new Identifier();
```

Patient Model Datatype:
https://hl7.org/fhir/patient.html

### Fhir Rest

# Creating a Fhir Client Server

For setting up the client server, it will be used the fhir public servers.

A FhirClient works with a single server. If you work with multiple servers simultanuously, you’ll have to create a FhirClient for each of them. Since resources may reference other resources on a different FHIR server, you’ll have to inspect any references and direct them to the right FhirClient.

# Methods / Constructors:

### FhirClient

The constructor method is overloaded, to enable you to use a URI instead of a string. As second parameter to the constructor, you can specify whether the client should perform a conformance check to see if the server has got a compatible FHIR version.
The default setting is false.

```bash
private const string fhirServer = "http://vonk-fire.ly";
var client = new FhirClient(fhirServer);

#or

var client = new FhirClient("http://vonk-fire.ly");

```

### FhirClientSettings

To specify some specific settings, you add a **FhirClientSettings** to the constructor.

```bash
var settings = new FhirClientSettings
        {
            Timeout = 0,
            PreferredFormat = ResourceFormat.Json,
            VerifyFhirVersion = true,
            ReturnPreference = ReturnPreference.Minimal
        };
var client = new FhirClient("http://server.fire.ly", settings)
```

You can also toggle these settings after the client has been initialized.

#### PreferredFormat

To specify the preferred format –JSON or XML– of the content to be used when communicating with the FHIR server, you can use the **PreferredFormat** attribute.
The default setting for this field is XML.

```bash
client.Settings.PreferredFormat = ResourceFormat.Json;
```

#### UseFormatParameter

When communicating the preferred format to the server, this can either be done by appending _format=[format] to the URL, or setting the Accept HTTP header. The client uses the latter by default, but if you want, you can use the _format parameter instead.

```bash
client.Settings.UseFormatParameter = true;
```

## Conecting the Client to the server

```bash
namespace fhir1srProject
{
    class Programm
    {
        #associating the server 
        private const string fhirServer = "http://vonk-fire.ly";
  
        static void Main(String[] args)
        {
            #associating the server to the client
            FhirClient fhirClient = new FhirClient(fhirServer);
	  
	    #preferred settings
	    var settigs = new FhirClientSettings
            {
                PreferredFormat = ResourceFormat.Json,
                ReturnPreference = ReturnPreference.Representation,
            };
        }
    }
}
```
